---
title: Запуск кількох екземплярів вашого застосунку
weight: 10
description: |-
    Масштабування застосунку вручну за допомогою kubectl.
---

<!DOCTYPE html>

<html lang="uk">

<body>

    <div class="layout" id="top">

        <main class="content">

            <div class="row">

         <div class="col-md-8">
              <h3>Мета</h3>
                    <ul>
                        <li>Масштабування застосунку за допомогою kubectl.</li>
                    </ul>

           <h3>Масштабування Застосунку</h3>

                <p>Раніше ми створили <a href="/uk/docs/concepts/workloads/controllers/deployment/">Deployment</a>, а потім робили його загальнодоступним за допомогою <a href="/uk/docs/concepts/services-networking/service/">Service</a>. Deployment створив лише один Pod для запуску нашого pfcnjceyre. Зі збільшенням трафіку, нам потрібно масштабувати застосунок, щоб відповідати зростаючим вимогам користувачів.</p>
                <p>Якщо ви ще не працювали над попередніми розділами, почніть з <a href="/uk/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/">Використання minikube для створення кластера</a>.</p>

                <p><em>Масштабування</em> досягається зміною кількості реплік в Deployment.</p>
                </br>
                </div>
                <div class="col-md-4">
                    <div class="content__box content__box_lined">
                        <h3>Зміст:</h3>
                        <ul>
                            <li>Масштабування Deployment</li>
                        </ul>
                    </div>
                    <div class="content__box content__box_fill">
                        <p><i>Ви можете створити Deployment з початку з декількома екземплярами, використовуючи параметр <tt>--replicas</tt> для команди створення Deployment kubectl</i></p>
                    </div>
                </div>
            </div>

            <div class="row">
              <div class="col-md-12">
                {{< note >}}
                <p>Якщо ви спробуєте це після <a href="/uk/docs/tutorials/kubernetes-basics/expose/expose-intro/">попереднього розділу</a>, то, можливо, ви видалили Service, який створили, або створили Service з <tt>type: NodePort</tt>. У цьому розділі припускається, що для Deployment kubernetes-bootcamp створено Service з <tt>type: LoadBalancer</tt>.</p>
                <p>Якщо ви <em>не</em> видалили Service, створений в <a href="/uk/docs/tutorials/kubernetes-basics/expose/expose-intro">попередньому розділі</a>, спочатку видаліть цей Service, а потім запустіть наступну команду для створення нового Service з параметром <tt>type</tt> встановленим на <tt>LoadBalancer</tt>:</p>
                <p><code><b>kubectl expose deployment/kubernetes-bootcamp --type="LoadBalancer" --port 8080</b></code></p>
                {{< /note >}}
              </div>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <h2 style="color: #3771e3;">Огляд масштабування</h2>
                </div>
            </div>

            <div class="row">
                <div class="col-md-1"></div>
                <div class="col-md-8">
                    <div id="myCarousel" class="carousel" data-ride="carousel" data-interval="3000">
                        <ol class="carousel-indicators">
                            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                            <li data-target="#myCarousel" data-slide-to="1"></li>
                        </ol>
                          <div class="carousel-inner" role="listbox">
                            <div class="item carousel-item active">
                              <img src="/docs/tutorials/kubernetes-basics/public/images/module_05_scaling1.svg">
                            </div>

                            <div class="item carousel-item">
                              <img src="/docs/tutorials/kubernetes-basics/public/images/module_05_scaling2.svg">
                            </div>
                          </div>

                          <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                            <span class="sr-only ">Попередня</span>
                          </a>
                          <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                            <span class="sr-only">Наступна</span>
                          </a>

                        </div>
                </div>
            </div>

            <br>

            <div class="row">
                <div class="col-md-8">

                    <p>Масштабування Deployment гарантує створення нових Podʼів і їх призначення на Вузли з вільними ресурсами. Масштабування збільшить кількість Podʼів до нового бажаного стану. Kubernetes також підтримує <a href="/uk/docs/tasks/run-application/horizontal-pod-autoscale/">автоматичне масштабування</a> Podʼів, але це виходить за рамки цього посібника. Також можливе масштабування до нуля, і це призведе до завершення всіх Podʼів вказаного Deployment.</p>

                    <p>Запуск кількох екземплярів застосунку вимагає засобів для розподілу трафіку між ними. У Service є вбудований балансер навантаження, який розподілить мережевий трафік на всі Podʼи, що виставлені Deployment. Service будуть постійно відстежувати робочі Podʼи, використовуючи точки доступу, щоб гарантувати, що трафік направляється лише на доступні Podʼи.</p>

                </div>
                <div class="col-md-4">
                    <div class="content__box content__box_fill">
                        <p><i>Масштабування досягається зміною кількості реплік в Deployment.</i></p>
                    </div>
                </div>
            </div>

            <br>

            <div class="row">
                <div class="col-md-8">
                    <p> Якщо у вас є кілька екземплярів застосунку, ви зможете робити оновлення без перерв. Ми розглянемо це в наступному розділі посібника. Тепер перейдемо до термінала та масштабуємо наш застосунок.</p>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                   <h3>Масштабування Deployment</h3>
                   <p>Щоб переглянути свій Deployment, використовуйте команду <code>get deployments</code>:</p>
                   <p><code><b>kubectl get deployments</b></code></p>
                   <p>Вивід повинен бути схожий на:</p>
    <pre>
    NAME                  READY   UP-TO-DATE   AVAILABLE   AGE
    kubernetes-bootcamp   1/1     1            1           11m
    </pre>
                   <p>Маємо 1 Pod. Якщо цього немає, виконайте команду ще раз. Тут маємо:</p>
                   <ul>
                   <li><em>NAME</em> — назви Deployment в кластері.</li>
                   <li><em>READY</em> — показує співвідношення поточних/бажаних реплік</li>
                   <li><em>UP-TO-DATE</em> — показує кількість реплік, які були оновлені для досягнення бажаного стану.</li>
                   <li><em>AVAILABLE</em> — показує, скільки реплік застосунку доступні користувачам.</li>
                   <li><em>AGE</em> — показує час, протягом якого застосунок працює.</li>
                   </ul>
                   <p>Щоб переглянути ReplicaSet, створений Deployment, виконайте:</p>
                   <p><code><b>kubectl get rs</b></code></p>
                   <p>Зверніть увагу, що назва ReplicaSet завжди форматується як <tt>[DEPLOYMENT-NAME]-[ВИПАДКОВИЙ-РЯДОК]</tt>. Випадковий рядок генерується випадковим чином та використовує <em>pod-template-hash</em> як основу для створеня.</p>
                   <p>Два важливі стовпці цього виводу:</p>
                   <ul>
                   <li><em>DESIRED</em> — показує бажану кількість реплік застосунку, яку ви визначаєте під час створення Deployment. Це бажаний стан.</li>
                   <li><em>CURRENT</em> — показує, скільки реплік в цей час працюють.</li>
                   </ul>
                   <p>Далі масштабуймо Deployment до 4 реплік. Ми використаємо команду <code>kubectl scale</code>, за якою слідує тип Deployment, назва та бажана кількість екземплярів:</p>
                   <p><code><b>kubectl scale deployments/kubernetes-bootcamp --replicas=4</b></code></p>
                   <p>Щоб знову переглянути свої Deployment, використовуйте <code>get deployments</code>:</p>
                   <p><code><b>kubectl get deployments</b></code></p>
                   <p>Зміни були застосовані, і у нас є 4 екземпляри застосунку. Далі перевірмо, чи змінилася кількість Podʼів:</p>
                   <p><code><b>kubectl get pods -o wide</b></code></p>
                   <p>Тепер є 4 Podʼа з різними IP-адресами. Зміна була зареєстрована в журналі подій Deployment. Щоб перевірити це, використовуйте команду describe:</p>
                   <p><code><b>kubectl describe deployments/kubernetes-bootcamp</b></code></p>
                   <p>Ви також можете побачити, що у виводі цієї команди тепер є 4 репліки.</p>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                   <h3>Балансування навантаження</h3>
                   <p>Перевіримо, чи Service балансує трафік. Щоб дізнатися зовнішній IP та порт, ми можемо використовувати команду describe, як ми дізнались в попередній частині посібника:</p>
                   <p><code><b>kubectl describe services/kubernetes-bootcamp</b></code></p>
                   <p>Створіть змінну середовища з іменем <tt>NODE_PORT</tt>, яка має значення як порт Вузла:</p>
                   <p><code><b>export NODE_PORT="$(kubectl get services/kubernetes-bootcamp -o go-template='{{(index .spec.ports 0).nodePort}}')"</b></code><br />
                   <p><code><b>echo NODE_PORT=$NODE_PORT</b></code></p>
                   <p>Далі ми запустимо <code>curl</code> з зовнішньою IP-адресою та портом. Виконайте команду кілька разів:</p>
                   <p><code><b>curl http://"$(minikube ip):$NODE_PORT"</b></b></b></code></p>
                   <p>Ми потрапляємо на різні Podʼи при кожному запиті. Це демонструє, що балансування навантаження працює.</p>
                   <p>Вивід має бути схожим на:</p>
                     <pre>
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-644c5687f4-wp67j | v=1
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-644c5687f4-hs9dj | v=1
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-644c5687f4-4hjvf | v=1
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-644c5687f4-wp67j | v=1
Hello Kubernetes bootcamp! | Running on: kubernetes-bootcamp-644c5687f4-4hjvf | v=1
                     </pre>
                   {{< note >}}<p>Якщо ви використовуєте minikube з Docker Desktop як драйвер контейнера, потрібен тунель minikube. Це через те, що контейнери всередині Docker Desktop ізольовані від вашого компʼютера-хосту.<br>
                    <p>В окремому вікні термінала виконайте:<br>
                      <code><b>minikube service kubernetes-bootcamp --url</b></code></p>
                    <p>Вивід виглядає так:
                      <pre><b>http://127.0.0.1:51082<br>!  Оскільки ви використовуєте драйвер Docker на darwin, термінал повинен бути відкритий для його запуску.</b></pre></p>
                    <p>Потім використовуйте наданий URL для доступу до застосунку:<br>
                      <code><b>curl 127.0.0.1:51082</b></code></p>
                   {{< /note >}}
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                   <h3>Зменшення розгортання</h3>
                   <p>Щоб зменшити Deployment до 2 реплік, знову запустіть команду <code>scale</code>:</p>
                   <p><code><b>kubectl scale deployments/kubernetes-bootcamp --replicas=2</b></code></p>
                   <p>Перевірте Deployment, щоб переконатися, що зміни були застосовані, за допомогою команди <code>get deployments</code>:</p>
                   <p><code><b>kubectl get deployments</b></code></p>
                   <p>Кількість реплік зменшилася до 2. Перегляньте кількість Podʼів за допомогою <code>get pods</code>:</p>
                   <p><code><b>kubectl get pods -o wide</b></code></p>
                   <p>Це підтверджує, що роботу двох Podʼів було завершено.</p>
                </div>
            </div>

          <div class="row">
              <p>
                Якщо ви готові, переходьте до <a href="/uk/docs/tutorials/kubernetes-basics/update/update-intro/" title="Виконання поступового оновлення">Виконання поступового оновлення</a>.
              </p>
          </div>

        </main>

    </div>

</body>

</html>
